{
  "version": 3,
  "file": "util.js",
  "sourceRoot": "",
  "sources": [
    "../src/util.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import { execFile, spawn as _spawn } from \"child_process\"\nimport { Promise as BluebirdPromise } from \"bluebird\"\nimport readPackageJsonAsync = require(\"read-package-json\")\nimport * as os from \"os\"\nimport * as path from \"path\"\nimport { readJson, stat } from \"fs-extra-p\"\nimport { yellow } from \"chalk\"\nimport debugFactory = require(\"debug\")\nimport { Debugger } from \"~debug/node\"\n\n//noinspection JSUnusedLocalSymbols\nconst __awaiter = require(\"./awaiter\")\n\nexport const log = console.log\n\nexport const debug: Debugger = debugFactory(\"electron-builder\")\n\nexport function warn(message: string) {\n  console.warn(yellow(message))\n}\n\nconst DEFAULT_APP_DIR_NAMES = [\"app\", \"www\"]\n\nexport const readPackageJson = BluebirdPromise.promisify(readPackageJsonAsync)\n\nexport function installDependencies(appDir: string, electronVersion: string, arch: string = process.arch, command: string = \"install\"): BluebirdPromise<any> {\n  log((command === \"install\" ? \"Installing\" : \"Rebuilding\") + \" app dependencies for arch %s to %s\", arch, appDir)\n  const gypHome = path.join(os.homedir(), \".electron-gyp\")\n  const env = Object.assign({}, process.env, {\n    npm_config_disturl: \"https://atom.io/download/atom-shell\",\n    npm_config_target: electronVersion,\n    npm_config_runtime: \"electron\",\n    npm_config_arch: arch,\n    HOME: gypHome,\n    USERPROFILE: gypHome,\n  })\n\n  let npmExecPath = process.env.npm_execpath || process.env.NPM_CLI_JS\n  const npmExecArgs = [command, \"--production\"]\n  if (npmExecPath == null) {\n    npmExecPath = process.platform === \"win32\" ? \"npm.cmd\" : \"npm\"\n  }\n  else {\n    npmExecArgs.unshift(npmExecPath)\n    npmExecPath = process.env.npm_node_execpath || process.env.NODE_EXE || \"node\"\n  }\n\n  return spawn(npmExecPath, npmExecArgs, {\n    cwd: appDir,\n    stdio: \"inherit\",\n    env: env\n  })\n}\n\nexport interface BaseExecOptions {\n  cwd?: string\n  env?: any\n  stdio?: any\n}\n\nexport interface ExecOptions extends BaseExecOptions {\n  customFds?: any\n  encoding?: string\n  timeout?: number\n  maxBuffer?: number\n  killSignal?: string\n}\n\nexport interface SpawnOptions extends BaseExecOptions {\n  custom?: any\n  detached?: boolean\n}\n\nexport function exec(file: string, args?: string[], options?: ExecOptions): BluebirdPromise<Buffer[]> {\n  if (debug.enabled) {\n    debug(`Executing ${file} ${args.join(\" \")}`)\n  }\n\n  return new BluebirdPromise<Buffer[]>((resolve, reject) => {\n    execFile(file, args, options, function (error, stdout, stderr) {\n      if (error == null) {\n        resolve([stdout, stderr])\n      }\n      else {\n        if (stdout.length !== 0) {\n          console.log(stdout.toString())\n        }\n        if (stderr.length === 0) {\n          reject(error)\n        }\n        else {\n          reject(new Error(stderr.toString() + \"\\n\" + error.toString()))\n        }\n      }\n    })\n  })\n}\n\nexport function spawn(command: string, args?: string[], options?: SpawnOptions): BluebirdPromise<any> {\n  if (debug.enabled) {\n    debug(`Spawning ${command} ${args.join(\" \")}`)\n  }\n\n  return new BluebirdPromise<any>((resolve, reject) => {\n    const p = _spawn(command, args, options)\n    p.on(\"close\", (code: number) => code === 0 ? resolve() : reject(new Error(command + \" exited with code \" + code)))\n  })\n}\n\nexport async function getElectronVersion(packageData: any, packageJsonPath: string): Promise<string> {\n  try {\n    return (await readJson(path.join(path.dirname(packageJsonPath), \"node_modules\", \"electron-prebuilt\", \"package.json\"))).version\n  }\n  catch (e) {\n    if (e.code !== \"ENOENT\") {\n      warn(\"Cannot read electron version from electron-prebuilt package.json\" + e.message)\n    }\n  }\n\n  const devDependencies = packageData.devDependencies\n  let electronPrebuiltDep: string = devDependencies == null ? null : devDependencies[\"electron-prebuilt\"]\n  if (electronPrebuiltDep == null) {\n    const dependencies = packageData.dependencies\n    electronPrebuiltDep = dependencies == null ? null : dependencies[\"electron-prebuilt\"]\n  }\n\n  if (electronPrebuiltDep == null) {\n    throw new Error(\"Cannot find electron-prebuilt dependency to get electron version in the '\" + packageJsonPath + \"'\")\n  }\n\n  const firstChar = electronPrebuiltDep[0]\n  return firstChar === \"^\" || firstChar === \"~\" ? electronPrebuiltDep.substring(1) : electronPrebuiltDep\n}\n\nexport async function statOrNull(file: string) {\n  try {\n    return await stat(file)\n  }\n  catch (e) {\n    if (e.code === \"ENOENT\") {\n      return null\n    }\n    else {\n      throw e\n    }\n  }\n}\n\nexport async function computeDefaultAppDirectory(projectDir: string, userAppDir: string): Promise<string> {\n  if (userAppDir != null) {\n    const absolutePath = path.join(projectDir, userAppDir)\n    const stat = await statOrNull(absolutePath)\n    if (stat == null) {\n      throw new Error(`Application directory ${userAppDir} doesn't exists`)\n    }\n    else if (!stat.isDirectory()) {\n      throw new Error(`Application directory ${userAppDir} is not a directory`)\n    }\n    return absolutePath\n  }\n\n  for (let dir of DEFAULT_APP_DIR_NAMES) {\n    const absolutePath = path.join(projectDir, dir)\n    const stat = await statOrNull(absolutePath)\n    if (stat != null && stat.isDirectory()) {\n      return absolutePath\n    }\n  }\n  return projectDir\n}\n\nexport function use<T, R>(value: T, task: (it: T) => R): R {\n  return value == null ? null : task(value)\n}"
  ]
}
